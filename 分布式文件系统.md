# 分布式文件系统

​	分布式文件系统（Distributed  File Systems）是文件系统的经典分时模型的分布式实现，其中多个用户可以共享文件和存储资源。DFS是一种文件系统，其客户端、服务器和存储设备分散在分布式系统的机器中。

## 基本概念

（1）透明性（transparency）

​	实际上， DFS 应该对它的客户端看起来就像一个传统的集中式文件系统。也就是说，服务器和存储设备的多样性和分散性应该对客户端是透明的。

+ 网络透明性（network transparency）：客户端应能够使用与本地文件相同的一组文件操作来访问远程文件。也就是说， DFS 的客户端接口不应区分本地和远程文件。
+ 用户移动性（user mobility）：用户可以自由登录系统中的任何一台机器，无论用户在何处登录，都能通过DFS获取用户环境（如主目录）。

（2）性能指标

​	DFS 的重要性能度量是满足服务请求所需的时间。在传统系统中，这个时间包括磁盘访问时间和少量的CPU处理时间。在分布式文件系统中，还要加上因远程访问而产生的额外的开销。这些开销包括将请求发送到服务器所需的时间，以及通过网络将响应结果传回客户端所需的时间。对于每个方向，除了实际的信息传输外，还有运行通信协议软件所需的CPU开销。

​	分布式文件系统的性能可以视为其透明度的另一个维度；也就是说，分布式文件系统的性能应该与传统文件系统相当。

（3）容错（fault tolerance）

​	通信故障、机器故障（如停机）、存储设备崩溃以及存储介质老化都被视为在一定程度上可以容忍的故障。容错系统在这些故障发生时应继续运行，即使是以降级的形式。这种降级可能表现在性能、功能或两者兼有。当少数组件发生故障时系统就完全停止运行，这样的系统不具备容错能力。

（4）可扩展性（scalability）

​	系统适应增加的服务负载的能力称为可扩展性。简而言之，一个可扩展的设计应该能够承受高服务负载，适应用户规模的增长，并能够简单地集成新增资源。

（5）位置透明性（location transparency）

​	文件的名称不提供任何与其位置信息有关的提示。即名称和位置的绑定是动态的。

## 分布式文件系统的分类

（1）架构

+ 客户-服务器架构（**Client Server Architectures**），例如NFS文件系统。这种传统的DFS配备了一种通信协议，允许客户端访问存储在服务器上的文件，从而使得运行在不同操作系统和机器上的异构进程能够共享一个共同的文件系统。该方案的优势在于其很大程度上独立于本地文件系统。

+ 基于集群的分布式文件系统（**Cluster-Based Distributed File System**），例如谷歌文件系统。它由一个主服务器和多个块服务器组成，文件被划分为大小为64MB的块。其优点是十分简单，它允许主服务器控制几百个块服务器。

（2）通信

​	大部分 DFS 使用远程过程调用（Remote Procedure Call，RPC）方法进行通信，使系统独立于底层操作系统、网络和传输协议。在 RPC 方法中，通常被考虑的是 TCP 和 UDP 两种通信协议。 TCP 被所有 DFS 广泛使用，而 UDP 在 Hadoop 中被用来提升性能。

（3）命名

​	每个对象都与一个逻辑上的路径名和物理上的地址关联，所有逻辑路径名的聚合构成了一个分布式命名空间。目前常用的方法是使用**中央元数据服务器**来管理文件命名空间。因此，分离元数据和数据可以提高文件命名空间的吞吐率并缓解同步问题。另一种方法是**元数据分布在所有节点中**，使得所有节点都能理解磁盘结构。缺点是由于安全问题，用户无法共享命名空间，这使得文件共享更加困难。

（4）同步

​	当一个文件被两个或更多的用户所共享时，有必要精确定义读写[语义]([文件共享服务中的数据一致性模型：强弱一致性详解,-CSDN博客](https://blog.csdn.net/mzgxinhua/article/details/134671647))以避免问题，可用的包括 UNIX 语义、会话语义、不可变语义和事务。除了语义之外，我们还考虑分析 DFS 中的**文件锁定系统**。根据部署在 DFS 上的应用程序的目的，它采用了不同的锁定机制。最常见的是一次写多次读访问模型。然而，像搜索引擎这样的应用则需要多生产者单消费者访问模型。 GFS 就是这种模型的著名例子。为了支持它们的访问模型，一些系统选择向客户端授予对象锁，而另一些则选择在服务器上同步执行所有操作。向客户端授予对象锁通过客户端缓存实现了性能提升。 Lustre 采用了混合解决方案来实现文件锁定系统。在 Lustre 中，锁定模式的选择取决于资源竞争水平。

（5）一致性和复制

​	为了保证一致性，大部分 DFS 在通过网络传输数据后使用**检查和**进行验证。另一个重要的技术是**客户端缓存**和**服务器端复制**。对于元数据来说，所有 DFS 都提供一种机制来确保此其可用性和可恢复性，例如备份元数据服务器和带有事务日志的元数据快照。对于数据对象，根据应用程序的目的，有不同的处理方法。像 Lustre 和 Panasas 这样的分布式文件系统假设只要物理设备可用，数据对象就一直可用。因此，它们将物理故障视为异常情况，对象数据可能会丢失。然而，有些系统如 Lustre 支持 RAID0 模型来存储数据，以降低数据丢失的概率并提高访问性能。而对于其他分布式文件系统，如 GFS 和 Hadoop ，其应用要求数据的可用性是关键条件，故障将是常态而非例外。因此，数据对象会在不同的服务器上进行复制。这一高带宽消耗特性导致了异步复制方法的使用。

（6）容错

​	容错与复制功能密切相关。对象数据的容错有两种方法：**故障作为异常**和**故障作为常态**。故障作为异常的系统会隔离故障节点或将系统从上次正常运行状态恢复。故障作为常态的系统则采用所有类型数据的复制，并在复制比例变得不安全时执行重新复制。

